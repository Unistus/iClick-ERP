
{
  "entities": {
    "DocumentSequence": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DocumentSequence",
      "type": "object",
      "description": "Configures prefixes and incremental numbering for various system documents like invoices and receipts.",
      "properties": {
        "id": { "type": "string", "description": "Unique key for the sequence type (e.g., 'sales_invoice')." },
        "institutionId": { "type": "string", "description": "Reference to the owner Institution." },
        "title": { "type": "string", "description": "Display name of the document type." },
        "prefix": { "type": "string", "description": "String prepended to the number (e.g., 'INV-')." },
        "suffix": { "type": "string", "description": "String appended to the number (e.g., '/2024')." },
        "nextNumber": { "type": "number", "description": "The next integer to be assigned." },
        "padding": { "type": "number", "description": "Total length of the numeric part with leading zeros." },
        "isActive": { "type": "boolean", "description": "Whether this sequence is currently used." },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "institutionId", "title", "prefix", "nextNumber", "padding"]
    },
    "Institution": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Institution",
      "type": "object",
      "description": "Represents a top-level business organization or tenant within the iClick ERP system, enabling multi-tenant architecture.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Institution entity."
        },
        "name": {
          "type": "string",
          "description": "The legal name of the institution."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL to the institution's logo.",
          "format": "uri"
        },
        "country": {
          "type": "string",
          "description": "The primary country of operation for the institution, influencing tax and localization."
        },
        "defaultCurrencyId": {
          "type": "string",
          "description": "Reference to the default Currency used by the institution. (Relationship: Currency 1:N Institution)"
        },
        "taxIdentificationNumber": {
          "type": "string",
          "description": "The institution's tax identification number (e.g., VAT number, TIN)."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the institution is currently active."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the institution record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the institution record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "country",
        "defaultCurrencyId",
        "isActive",
        "createdAt"
      ]
    },
    "Currency": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Currency",
      "type": "object",
      "description": "Defines different currencies supported by the system for multi-currency operations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Currency entity (e.g., 'USD', 'KES')."
        },
        "name": {
          "type": "string",
          "description": "The full name of the currency (e.g., 'United States Dollar')."
        },
        "symbol": {
          "type": "string",
          "description": "The symbol for the currency (e.g., '$', 'KSh')."
        },
        "exchangeRateToBase": {
          "type": "number",
          "description": "The exchange rate of this currency relative to the system's base currency."
        },
        "isBaseCurrency": {
          "type": "boolean",
          "description": "Indicates if this is the base currency for exchange rate calculations."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the currency record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the currency record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "symbol",
        "exchangeRateToBase",
        "isBaseCurrency",
        "createdAt"
      ]
    },
    "TaxSetting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TaxSetting",
      "type": "object",
      "description": "Configures various tax rates and rules applicable to products and services, supporting cross-border tax logic.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TaxSetting entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this tax setting belongs to. (Relationship: Institution 1:N TaxSetting)"
        },
        "name": {
          "type": "string",
          "description": "Name of the tax (e.g., 'VAT 16%', 'Withholding Tax')."
        },
        "rate": {
          "type": "number",
          "description": "The percentage rate of the tax (e.g., 0.16 for 16%)."
        },
        "type": {
          "type": "string",
          "description": "The type of tax (e.g., 'VAT', 'Sales Tax', 'Withholding Tax')."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the tax setting."
        },
        "countryCode": {
          "type": "string",
          "description": "The ISO 3166-1 alpha-2 country code where this tax applies."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the tax setting is currently active."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the tax setting was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the tax setting was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "rate",
        "type",
        "countryCode",
        "isActive",
        "createdAt"
      ]
    },
    "Branch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Branch",
      "type": "object",
      "description": "Represents a physical location or sub-division of an institution, supporting multi-branch chains.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Branch entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this branch belongs to. (Relationship: Institution 1:N Branch)"
        },
        "name": {
          "type": "string",
          "description": "The name of the branch."
        },
        "address": {
          "type": "string",
          "description": "The physical address of the branch."
        },
        "contactEmail": {
          "type": "string",
          "description": "The contact email for the branch.",
          "format": "email"
        },
        "contactPhone": {
          "type": "string",
          "description": "The contact phone number for the branch."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the branch is currently active."
        },
        "defaultTaxSettingId": {
          "type": "string",
          "description": "Reference to the default TaxSetting for this branch. (Relationship: TaxSetting 1:N Branch)"
        },
        "defaultCurrencyId": {
          "type": "string",
          "description": "Reference to the default Currency for this branch. (Relationship: Currency 1:N Branch)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the branch record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the branch record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "address",
        "isActive",
        "defaultCurrencyId",
        "createdAt"
      ]
    },
    "Department": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Department",
      "type": "object",
      "description": "Defines departments within a branch or institution for organizational structure and budgeting.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Department entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this department belongs to. (Relationship: Institution 1:N Department)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch this department belongs to. (Relationship: Branch 1:N Department)"
        },
        "name": {
          "type": "string",
          "description": "The name of the department (e.g., 'Sales', 'HR', 'Kitchen')."
        },
        "description": {
          "type": "string",
          "description": "A description of the department's function."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the department record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the department record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "branchId",
        "name",
        "createdAt"
      ]
    },
    "Permission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Permission",
      "type": "object",
      "description": "Defines a specific action or resource access within the system for granular Role-Based Access Control (RBAC).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Permission entity."
        },
        "name": {
          "type": "string",
          "description": "The programmatic name of the permission (e.g., 'product:create', 'sale:read')."
        },
        "description": {
          "type": "string",
          "description": "A human-readable description of what the permission allows."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the permission record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the permission record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "createdAt"
      ]
    },
    "Role": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Role",
      "type": "object",
      "description": "Groups a set of permissions to define user roles within the system, enabling multi-user with role control.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Role entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this role belongs to. (Relationship: Institution 1:N Role)"
        },
        "name": {
          "type": "string",
          "description": "The name of the role (e.g., 'Admin', 'Cashier', 'Inventory Manager')."
        },
        "description": {
          "type": "string",
          "description": "A description of the responsibilities associated with the role."
        },
        "permissionIds": {
          "type": "array",
          "description": "References to Permissions granted to this role. (Relationship: Permission N:N Role)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the role record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the role record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "description",
        "permissionIds",
        "createdAt"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a system user with associated roles and access, relying on an external authentication system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity, typically from an external authentication system."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution the user belongs to. (Relationship: Institution 1:N User)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the primary Branch the user is associated with. (Relationship: Branch 1:N User)"
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number."
        },
        "roleIds": {
          "type": "array",
          "description": "References to Roles assigned to this user. (Relationship: Role N:N User)",
          "items": {
            "type": "string"
          }
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the user account is currently active."
        },
        "lastLogin": {
          "type": "string",
          "description": "Timestamp of the user's last login.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the user record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the user record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "firstName",
        "lastName",
        "email",
        "roleIds",
        "isActive",
        "createdAt"
      ]
    },
    "ApprovalWorkflow": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApprovalWorkflow",
      "type": "object",
      "description": "Defines the rules and stages for multi-level approval processes within the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ApprovalWorkflow entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this workflow belongs to. (Relationship: Institution 1:N ApprovalWorkflow)"
        },
        "name": {
          "type": "string",
          "description": "The name of the approval workflow (e.g., 'Expense Approval', 'Discount Approval')."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of what this workflow is for."
        },
        "triggerType": {
          "type": "string",
          "description": "The type of event that triggers this workflow (e.g., 'Expense', 'Discount', 'CreditSale')."
        },
        "minAmount": {
          "type": "number",
          "description": "The minimum amount that triggers this approval workflow, if applicable."
        },
        "approverRoleIds": {
          "type": "array",
          "description": "References to Roles whose members are authorized to approve requests in this workflow. (Relationship: Role N:N ApprovalWorkflow)",
          "items": {
            "type": "string"
          }
        },
        "isMultiLevel": {
          "type": "boolean",
          "description": "Indicates if this workflow requires multiple levels of approval."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the workflow is currently active."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the workflow was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the workflow was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "triggerType",
        "approverRoleIds",
        "isMultiLevel",
        "isActive",
        "createdAt"
      ]
    },
    "ApprovalRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApprovalRequest",
      "type": "object",
      "description": "Records an instance of an item awaiting or having undergone an approval process.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ApprovalRequest entity."
        },
        "workflowId": {
          "type": "string",
          "description": "Reference to the ApprovalWorkflow this request follows. (Relationship: ApprovalWorkflow 1:N ApprovalRequest)"
        },
        "requesterUserId": {
          "type": "string",
          "description": "Reference to the User who initiated the request. (Relationship: User 1:N ApprovalRequest)"
        },
        "requestType": {
          "type": "string",
          "description": "The type of item being requested for approval (e.g., 'Expense', 'Discount', 'CreditSale')."
        },
        "referenceEntityId": {
          "type": "string",
          "description": "The ID of the entity that requires approval (e.g., an Expense ID, Sale ID)."
        },
        "referenceEntityType": {
          "type": "string",
          "description": "The type of the entity that requires approval (e.g., 'Expense', 'Sale')."
        },
        "amount": {
          "type": "number",
          "description": "The monetary amount associated with the request, if applicable."
        },
        "status": {
          "type": "string",
          "description": "The current status of the approval request (e.g., 'Pending', 'Approved', 'Rejected', 'Canceled')."
        },
        "currentApproverUserId": {
          "type": "string",
          "description": "Reference to the User currently responsible for approving this request, if multi-level. (Relationship: User 1:N ApprovalRequest)"
        },
        "comments": {
          "type": "string",
          "description": "Comments related to the approval request or its decision."
        },
        "requestedAt": {
          "type": "string",
          "description": "Timestamp when the approval request was created.",
          "format": "date-time"
        },
        "approvedAt": {
          "type": "string",
          "description": "Timestamp when the request was approved.",
          "format": "date-time"
        },
        "rejectedAt": {
          "type": "string",
          "description": "Timestamp when the request was rejected.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the approval request record was initially created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the approval request record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "workflowId",
        "requesterUserId",
        "requestType",
        "referenceEntityId",
        "referenceEntityType",
        "status",
        "requestedAt",
        "createdAt"
      ]
    },
    "ProductCategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProductCategory",
      "type": "object",
      "description": "Organizes products into hierarchical categories for better management and reporting.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ProductCategory entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this category belongs to. (Relationship: Institution 1:N ProductCategory)"
        },
        "name": {
          "type": "string",
          "description": "The name of the product category (e.g., 'Electronics', 'Beverages')."
        },
        "description": {
          "type": "string",
          "description": "A description of the category."
        },
        "parentId": {
          "type": "string",
          "description": "Reference to the parent ProductCategory for hierarchical categorization. (Relationship: ProductCategory 1:N ProductCategory)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the category was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the category was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "createdAt"
      ]
    },
    "Vendor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vendor",
      "type": "object",
      "description": "Manages information about suppliers or vendors from whom products are purchased.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Vendor entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this vendor supplies. (Relationship: Institution 1:N Vendor)"
        },
        "name": {
          "type": "string",
          "description": "The legal name of the vendor/supplier."
        },
        "contactPerson": {
          "type": "string",
          "description": "The primary contact person at the vendor company."
        },
        "email": {
          "type": "string",
          "description": "The contact email address for the vendor.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The contact phone number for the vendor."
        },
        "address": {
          "type": "string",
          "description": "The physical address of the vendor."
        },
        "taxIdentificationNumber": {
          "type": "string",
          "description": "The vendor's tax identification number."
        },
        "paymentTerms": {
          "type": "string",
          "description": "Standard payment terms with this vendor (e.g., 'Net 30', 'Cash on Delivery')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the vendor record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the vendor record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "email",
        "phone",
        "createdAt"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a general product or service with core information, supporting multi-variant configurations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this product belongs to. (Relationship: Institution 1:N Product)"
        },
        "name": {
          "type": "string",
          "description": "The name of the product or service."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the product."
        },
        "sku": {
          "type": "string",
          "description": "The Stock Keeping Unit for the base product."
        },
        "barcode": {
          "type": "string",
          "description": "The primary barcode for the product."
        },
        "categoryIds": {
          "type": "array",
          "description": "References to ProductCategory entities this product belongs to. (Relationship: ProductCategory N:N Product)",
          "items": {
            "type": "string"
          }
        },
        "unitOfMeasure": {
          "type": "string",
          "description": "The standard unit of measure for this product (e.g., 'pcs', 'kg', 'liter')."
        },
        "isService": {
          "type": "boolean",
          "description": "Indicates if this is a service rather than a physical product."
        },
        "isTaxable": {
          "type": "boolean",
          "description": "Indicates if the product is subject to tax."
        },
        "taxSettingId": {
          "type": "string",
          "description": "Reference to the specific TaxSetting for this product, overriding the default. (Relationship: TaxSetting 1:N Product)"
        },
        "brand": {
          "type": "string",
          "description": "The brand name of the product."
        },
        "supplierId": {
          "type": "string",
          "description": "Reference to the primary Vendor supplying this product. (Relationship: Vendor 1:N Product)"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to the product's main image.",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the product record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the product record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "sku",
        "unitOfMeasure",
        "isService",
        "isTaxable",
        "createdAt"
      ]
    },
    "ProductVariant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProductVariant",
      "type": "object",
      "description": "Represents a specific variant of a product, handling different attributes, pricing, and stock levels.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ProductVariant entity."
        },
        "productId": {
          "type": "string",
          "description": "Reference to the parent Product. (Relationship: Product 1:N ProductVariant)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch where this variant's stock/pricing applies. (Relationship: Branch 1:N ProductVariant)"
        },
        "name": {
          "type": "string",
          "description": "A descriptive name for the variant (e.g., 'Red, Large', '500mg, Box of 10')."
        },
        "variantAttributes": {
          "type": "string",
          "description": "A JSON string representing key-value pairs of variant attributes (e.g., '{\"color\":\"Red\", \"size\":\"Large\"}')."
        },
        "sku": {
          "type": "string",
          "description": "The unique Stock Keeping Unit for this specific variant."
        },
        "barcode": {
          "type": "string",
          "description": "The barcode for this specific variant."
        },
        "retailPrice": {
          "type": "number",
          "description": "The selling price of this variant to customers."
        },
        "costPrice": {
          "type": "number",
          "description": "The cost of acquiring or producing this variant."
        },
        "currentStockQuantity": {
          "type": "number",
          "description": "The current quantity of this variant in stock at the specified branch."
        },
        "reorderLevel": {
          "type": "number",
          "description": "The stock level at which a reorder should be triggered."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to the variant's specific image.",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the variant record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the variant record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "branchId",
        "name",
        "sku",
        "retailPrice",
        "costPrice",
        "currentStockQuantity",
        "createdAt"
      ]
    },
    "Batch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Batch",
      "type": "object",
      "description": "Tracks products by batch number, including manufacturing and expiry dates, crucial for pharmacies and food retail.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Batch entity."
        },
        "productVariantId": {
          "type": "string",
          "description": "Reference to the ProductVariant this batch belongs to. (Relationship: ProductVariant 1:N Batch)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch where this batch is located. (Relationship: Branch 1:N Batch)"
        },
        "batchNumber": {
          "type": "string",
          "description": "The unique batch identifier."
        },
        "manufacturingDate": {
          "type": "string",
          "description": "The date when this batch was manufactured.",
          "format": "date"
        },
        "expiryDate": {
          "type": "string",
          "description": "The expiry date for this batch of products.",
          "format": "date"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of items in this batch."
        },
        "costPrice": {
          "type": "number",
          "description": "The cost price per unit for this batch."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the batch record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the batch record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productVariantId",
        "branchId",
        "batchNumber",
        "expiryDate",
        "quantity",
        "costPrice",
        "createdAt"
      ]
    },
    "SerialItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SerialItem",
      "type": "object",
      "description": "Tracks individual items by their unique serial number, useful for electronics and high-value goods.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SerialItem entity."
        },
        "productVariantId": {
          "type": "string",
          "description": "Reference to the ProductVariant this serial item belongs to. (Relationship: ProductVariant 1:N SerialItem)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch where this serial item is located. (Relationship: Branch 1:N SerialItem)"
        },
        "serialNumber": {
          "type": "string",
          "description": "The unique serial number of the item."
        },
        "status": {
          "type": "string",
          "description": "The current status of the serial item (e.g., 'In Stock', 'Sold', 'Returned', 'Damaged')."
        },
        "purchasePrice": {
          "type": "number",
          "description": "The price at which this specific serial item was purchased."
        },
        "saleItemId": {
          "type": "string",
          "description": "Reference to the SaleItem if this serial item has been sold. (Relationship: SaleItem 1:N SerialItem)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the serial item record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the serial item record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "productVariantId",
        "branchId",
        "serialNumber",
        "status",
        "purchasePrice",
        "createdAt"
      ]
    },
    "PurchaseOrder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PurchaseOrder",
      "type": "object",
      "description": "Manages purchase orders issued to vendors for acquiring goods.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PurchaseOrder entity."
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch placing the order. (Relationship: Branch 1:N PurchaseOrder)"
        },
        "vendorId": {
          "type": "string",
          "description": "Reference to the Vendor from whom goods are ordered. (Relationship: Vendor 1:N PurchaseOrder)"
        },
        "orderDate": {
          "type": "string",
          "description": "The date when the purchase order was created.",
          "format": "date-time"
        },
        "expectedDeliveryDate": {
          "type": "string",
          "description": "The anticipated date of delivery for the ordered goods.",
          "format": "date"
        },
        "status": {
          "type": "string",
          "description": "The current status of the purchase order (e.g., 'Draft', 'Ordered', 'Partially Received', 'Received', 'Cancelled')."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total monetary amount of the purchase order."
        },
        "currencyId": {
          "type": "string",
          "description": "Reference to the Currency of the purchase order. (Relationship: Currency 1:N PurchaseOrder)"
        },
        "createdByUserId": {
          "type": "string",
          "description": "Reference to the User who created the purchase order. (Relationship: User 1:N PurchaseOrder)"
        },
        "journalEntryId": {
          "type": "string",
          "description": "Reference to the JournalEntry created for this purchase order. (Relationship: JournalEntry 1:N PurchaseOrder)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the purchase order record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the purchase order record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "branchId",
        "vendorId",
        "orderDate",
        "status",
        "totalAmount",
        "currencyId",
        "createdByUserId",
        "createdAt"
      ]
    },
    "PurchaseOrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PurchaseOrderItem",
      "type": "object",
      "description": "Details individual items included in a purchase order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PurchaseOrderItem entity."
        },
        "purchaseOrderId": {
          "type": "string",
          "description": "Reference to the parent PurchaseOrder. (Relationship: PurchaseOrder 1:N PurchaseOrderItem)"
        },
        "productVariantId": {
          "type": "string",
          "description": "Reference to the ProductVariant being ordered. (Relationship: ProductVariant 1:N PurchaseOrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of this product variant ordered."
        },
        "unitPrice": {
          "type": "number",
          "description": "The agreed unit price for this product variant."
        },
        "totalPrice": {
          "type": "number",
          "description": "The total price for this line item (quantity * unit price)."
        },
        "receivedQuantity": {
          "type": "number",
          "description": "The quantity of this item that has been received so far."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the purchase order item record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the purchase order item record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "purchaseOrderId",
        "productVariantId",
        "quantity",
        "unitPrice",
        "totalPrice",
        "receivedQuantity",
        "createdAt"
      ]
    },
    "GoodsReceivedNote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GoodsReceivedNote",
      "type": "object",
      "description": "Documents the receipt of goods against a purchase order, updating inventory levels.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GoodsReceivedNote entity."
        },
        "purchaseOrderId": {
          "type": "string",
          "description": "Reference to the PurchaseOrder this GRN is for. (Relationship: PurchaseOrder 1:N GoodsReceivedNote)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch where goods were received. (Relationship: Branch 1:N GoodsReceivedNote)"
        },
        "receivedDate": {
          "type": "string",
          "description": "The date and time when the goods were received.",
          "format": "date-time"
        },
        "receivedByUserId": {
          "type": "string",
          "description": "Reference to the User who recorded the receipt of goods. (Relationship: User 1:N GoodsReceivedNote)"
        },
        "status": {
          "type": "string",
          "description": "Status of the GRN (e.g., 'Partial', 'Full', 'Pending Approval')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the GRN record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the GRN record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "purchaseOrderId",
        "branchId",
        "receivedDate",
        "receivedByUserId",
        "status",
        "createdAt"
      ]
    },
    "GoodsReceivedNoteItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GoodsReceivedNoteItem",
      "type": "object",
      "description": "Details individual items received as part of a Goods Received Note.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GoodsReceivedNoteItem entity."
        },
        "goodsReceivedNoteId": {
          "type": "string",
          "description": "Reference to the parent GoodsReceivedNote. (Relationship: GoodsReceivedNote 1:N GoodsReceivedNoteItem)"
        },
        "productVariantId": {
          "type": "string",
          "description": "Reference to the ProductVariant received. (Relationship: ProductVariant 1:N GoodsReceivedNoteItem)"
        },
        "quantityReceived": {
          "type": "number",
          "description": "The quantity of this item that was received."
        },
        "batchId": {
          "type": "string",
          "description": "Reference to the Batch if the received item is batch-tracked. (Relationship: Batch 1:N GoodsReceivedNoteItem)"
        },
        "serialNumbers": {
          "type": "array",
          "description": "Array of serial numbers for received serial-tracked items.",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the GRN item record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the GRN item record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "goodsReceivedNoteId",
        "productVariantId",
        "quantityReceived",
        "createdAt"
      ]
    },
    "StockTransfer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockTransfer",
      "type": "object",
      "description": "Records the movement of stock between different branches.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StockTransfer entity."
        },
        "fromBranchId": {
          "type": "string",
          "description": "Reference to the Branch from which stock is transferred. (Relationship: Branch 1:N StockTransfer)"
        },
        "toBranchId": {
          "type": "string",
          "description": "Reference to the Branch to which stock is transferred. (Relationship: Branch 1:N StockTransfer)"
        },
        "transferDate": {
          "type": "string",
          "description": "The date and time when the stock transfer was initiated.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The current status of the stock transfer (e.g., 'Requested', 'Shipped', 'Received', 'Cancelled')."
        },
        "requestedByUserId": {
          "type": "string",
          "description": "Reference to the User who requested the stock transfer. (Relationship: User 1:N StockTransfer)"
        },
        "shippedByUserId": {
          "type": "string",
          "description": "Reference to the User who processed the shipment of stock. (Relationship: User 1:N StockTransfer)"
        },
        "receivedByUserId": {
          "type": "string",
          "description": "Reference to the User who confirmed receipt of stock. (Relationship: User 1:N StockTransfer)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the stock transfer record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the stock transfer record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "fromBranchId",
        "toBranchId",
        "transferDate",
        "status",
        "requestedByUserId",
        "createdAt"
      ]
    },
    "StockTransferItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockTransferItem",
      "type": "object",
      "description": "Details individual product variants included in a stock transfer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StockTransferItem entity."
        },
        "stockTransferId": {
          "type": "string",
          "description": "Reference to the parent StockTransfer. (Relationship: StockTransfer 1:N StockTransferItem)"
        },
        "productVariantId": {
          "type": "string",
          "description": "Reference to the ProductVariant being transferred. (Relationship: ProductVariant 1:N StockTransferItem)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of this product variant transferred."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the stock transfer item record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the stock transfer item record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "stockTransferId",
        "productVariantId",
        "quantity",
        "createdAt"
      ]
    },
    "StockAdjustment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockAdjustment",
      "type": "object",
      "description": "Records manual or automated adjustments to inventory levels due to various reasons like damage, loss, or count discrepancies.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StockAdjustment entity."
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch where the stock adjustment occurred. (Relationship: Branch 1:N StockAdjustment)"
        },
        "productVariantId": {
          "type": "string",
          "description": "Reference to the ProductVariant being adjusted. (Relationship: ProductVariant 1:N StockAdjustment)"
        },
        "adjustmentDate": {
          "type": "string",
          "description": "The date and time of the stock adjustment.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "The type of adjustment (e.g., 'Damage', 'Loss', 'Count Discrepancy', 'Return', 'Theft')."
        },
        "quantityChange": {
          "type": "number",
          "description": "The change in quantity, positive for increase, negative for decrease."
        },
        "reason": {
          "type": "string",
          "description": "A detailed reason for the stock adjustment."
        },
        "adjustedByUserId": {
          "type": "string",
          "description": "Reference to the User who made the adjustment. (Relationship: User 1:N StockAdjustment)"
        },
        "journalEntryId": {
          "type": "string",
          "description": "Reference to the JournalEntry created for this stock adjustment. (Relationship: JournalEntry 1:N StockAdjustment)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the stock adjustment record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the stock adjustment record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "branchId",
        "productVariantId",
        "adjustmentDate",
        "type",
        "quantityChange",
        "reason",
        "adjustedByUserId",
        "createdAt"
      ]
    },
    "ChartOfAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChartOfAccount",
      "type": "object",
      "description": "Defines the hierarchical structure of all financial accounts used in the general ledger.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ChartOfAccount entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this account belongs to. (Relationship: Institution 1:N ChartOfAccount)"
        },
        "accountNumber": {
          "type": "string",
          "description": "A unique numeric or alphanumeric identifier for the account (e.g., '10100', 'SALES')."
        },
        "accountName": {
          "type": "string",
          "description": "The descriptive name of the account (e.g., 'Cash - Bank', 'Sales Revenue')."
        },
        "accountType": {
          "type": "string",
          "description": "The general type of the account (e.g., 'Asset', 'Liability', 'Equity', 'Revenue', 'Expense')."
        },
        "isDebitNormalBalance": {
          "type": "boolean",
          "description": "Indicates if the account typically has a debit balance (true) or a credit balance (false)."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the account's purpose."
        },
        "parentId": {
          "type": "string",
          "description": "Reference to the parent ChartOfAccount for hierarchical structuring. (Relationship: ChartOfAccount 1:N ChartOfAccount)"
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the account is currently active and in use."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "accountNumber",
        "accountName",
        "accountType",
        "isDebitNormalBalance",
        "isActive",
        "createdAt"
      ]
    },
    "JournalEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "JournalEntry",
      "type": "object",
      "description": "Groups related financial transactions into a single entry, representing a complete double-entry accounting event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the JournalEntry entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this journal entry belongs to. (Relationship: Institution 1:N JournalEntry)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch where this transaction originated. (Relationship: Branch 1:N JournalEntry)"
        },
        "entryDate": {
          "type": "string",
          "description": "The date and time when the journal entry was recorded.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A brief description of the financial event."
        },
        "referenceEntityId": {
          "type": "string",
          "description": "The ID of the source document or event (e.g., Sale ID, PurchaseOrder ID)."
        },
        "referenceEntityType": {
          "type": "string",
          "description": "The type of the source document or event (e.g., 'Sale', 'PurchaseOrder', 'PayrollRun', 'StockAdjustment')."
        },
        "status": {
          "type": "string",
          "description": "The status of the journal entry (e.g., 'Draft', 'Posted', 'Reversed')."
        },
        "createdByUserId": {
          "type": "string",
          "description": "Reference to the User who created this journal entry. (Relationship: User 1:N JournalEntry)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the journal entry record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the journal entry record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "branchId",
        "entryDate",
        "description",
        "status",
        "createdByUserId",
        "createdAt"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a single debit or credit entry within a journal entry, forming the basis of double-entry accounting.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Transaction entity."
        },
        "journalEntryId": {
          "type": "string",
          "description": "Reference to the parent JournalEntry this transaction belongs to. (Relationship: JournalEntry 1:N Transaction)"
        },
        "chartOfAccountId": {
          "type": "string",
          "description": "Reference to the ChartOfAccount affected by this transaction. (Relationship: ChartOfAccount 1:N Transaction)"
        },
        "amount": {
          "type": "number",
          "description": "The monetary amount of the transaction, always positive."
        },
        "isDebit": {
          "type": "boolean",
          "description": "Indicates if this transaction is a debit (true) or a credit (false)."
        },
        "description": {
          "type": "string",
          "description": "A specific description for this individual debit/credit transaction."
        },
        "currencyId": {
          "type": "string",
          "description": "Reference to the Currency of this transaction. (Relationship: Currency 1:N Transaction)"
        },
        "exchangeRate": {
          "type": "number",
          "description": "The exchange rate used if the transaction currency differs from the base currency."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the transaction record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the transaction record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "journalEntryId",
        "chartOfAccountId",
        "amount",
        "isDebit",
        "currencyId",
        "createdAt"
      ]
    },
    "Budget": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Budget",
      "type": "object",
      "description": "Manages departmental or organizational budgets, tracking allocated vs. actual spend.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Budget entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this budget belongs to. (Relationship: Institution 1:N Budget)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch this budget applies to (optional for institution-wide budgets). (Relationship: Branch 1:N Budget)"
        },
        "departmentId": {
          "type": "string",
          "description": "Reference to the Department this budget applies to (optional). (Relationship: Department 1:N Budget)"
        },
        "name": {
          "type": "string",
          "description": "The name of the budget (e.g., 'Q1 Marketing Budget', 'Annual IT Budget')."
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the budget period.",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the budget period.",
          "format": "date"
        },
        "status": {
          "type": "string",
          "description": "The status of the budget (e.g., 'Draft', 'Approved', 'Active', 'Closed')."
        },
        "budgetedAmount": {
          "type": "number",
          "description": "The total amount allocated for this budget."
        },
        "actualSpend": {
          "type": "number",
          "description": "The actual amount spent against this budget to date."
        },
        "currencyId": {
          "type": "string",
          "description": "Reference to the Currency of the budget. (Relationship: Currency 1:N Budget)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the budget record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the budget record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "startDate",
        "endDate",
        "status",
        "budgetedAmount",
        "currencyId",
        "createdAt"
      ]
    },
    "Employee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Employee",
      "type": "object",
      "description": "Stores detailed profiles and contract information for employees.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Employee entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution the employee works for. (Relationship: Institution 1:N Employee)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch the employee is primarily assigned to. (Relationship: Branch 1:N Employee)"
        },
        "departmentId": {
          "type": "string",
          "description": "Reference to the Department the employee belongs to. (Relationship: Department 1:N Employee)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User account if the employee is also a system user. (Relationship: User 1:N Employee)"
        },
        "firstName": {
          "type": "string",
          "description": "The employee's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The employee's last name."
        },
        "employeeNumber": {
          "type": "string",
          "description": "A unique internal employee identification number."
        },
        "email": {
          "type": "string",
          "description": "The employee's work email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The employee's contact phone number."
        },
        "address": {
          "type": "string",
          "description": "The employee's residential address."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "The employee's date of birth.",
          "format": "date"
        },
        "hireDate": {
          "type": "string",
          "description": "The date when the employee was hired.",
          "format": "date"
        },
        "jobTitle": {
          "type": "string",
          "description": "The employee's job title or position."
        },
        "salary": {
          "type": "number",
          "description": "The employee's base salary or wage."
        },
        "contractType": {
          "type": "string",
          "description": "The type of employment contract (e.g., 'Full-time', 'Part-time', 'Contractor')."
        },
        "status": {
          "type": "string",
          "description": "The current employment status (e.g., 'Active', 'On Leave', 'Terminated')."
        },
        "bankAccountNumber": {
          "type": "string",
          "description": "The employee's bank account number for payroll disbursements."
        },
        "taxIdentificationNumber": {
          "type": "string",
          "description": "The employee's tax identification number (e.g., KRA PIN)."
        },
        "statutoryDeductionIds": {
          "type": "array",
          "description": "References to StatutoryDeduction entities applicable to this employee. (Relationship: StatutoryDeduction N:N Employee)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the employee record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the employee record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "branchId",
        "firstName",
        "lastName",
        "employeeNumber",
        "email",
        "hireDate",
        "jobTitle",
        "salary",
        "contractType",
        "status",
        "createdAt"
      ]
    },
    "StatutoryDeduction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StatutoryDeduction",
      "type": "object",
      "description": "Configures mandatory statutory deductions like KRA, NHIF, NSSF for payroll processing.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StatutoryDeduction entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this deduction applies to. (Relationship: Institution 1:N StatutoryDeduction)"
        },
        "name": {
          "type": "string",
          "description": "The name of the statutory deduction (e.g., 'NSSF', 'NHIF', 'KRA PAYE')."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the deduction."
        },
        "calculationMethod": {
          "type": "string",
          "description": "The method used to calculate the deduction (e.g., 'PercentageOfGross', 'Tiered', 'FixedAmount')."
        },
        "rateOrRules": {
          "type": "string",
          "description": "A string or JSON string containing the rate, tiers, or specific rules for calculation."
        },
        "countryCode": {
          "type": "string",
          "description": "The ISO 3166-1 alpha-2 country code where this deduction applies."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the deduction is currently active."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the deduction record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the deduction record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "calculationMethod",
        "rateOrRules",
        "countryCode",
        "isActive",
        "createdAt"
      ]
    },
    "PayrollRun": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PayrollRun",
      "type": "object",
      "description": "Records the execution of a payroll process for a specific period, grouping all generated payslips.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PayrollRun entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this payroll run belongs to. (Relationship: Institution 1:N PayrollRun)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch for which payroll was run. (Relationship: Branch 1:N PayrollRun)"
        },
        "runDate": {
          "type": "string",
          "description": "The date and time when the payroll process was executed.",
          "format": "date-time"
        },
        "payPeriodStartDate": {
          "type": "string",
          "description": "The start date of the pay period covered by this payroll run.",
          "format": "date"
        },
        "payPeriodEndDate": {
          "type": "string",
          "description": "The end date of the pay period covered by this payroll run.",
          "format": "date"
        },
        "status": {
          "type": "string",
          "description": "The status of the payroll run (e.g., 'Draft', 'Processed', 'Paid', 'Reversed')."
        },
        "processedByUserId": {
          "type": "string",
          "description": "Reference to the User who processed this payroll run. (Relationship: User 1:N PayrollRun)"
        },
        "totalGrossPay": {
          "type": "number",
          "description": "The sum of gross salaries for all employees in this run."
        },
        "totalNetPay": {
          "type": "number",
          "description": "The sum of net salaries for all employees in this run."
        },
        "totalDeductions": {
          "type": "number",
          "description": "The total amount of all deductions in this run."
        },
        "currencyId": {
          "type": "string",
          "description": "Reference to the Currency used for this payroll run. (Relationship: Currency 1:N PayrollRun)"
        },
        "journalEntryId": {
          "type": "string",
          "description": "Reference to the JournalEntry created for this payroll run. (Relationship: JournalEntry 1:N PayrollRun)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the payroll run record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the payroll run record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "branchId",
        "runDate",
        "payPeriodStartDate",
        "payPeriodEndDate",
        "status",
        "processedByUserId",
        "totalGrossPay",
        "totalNetPay",
        "totalDeductions",
        "currencyId",
        "createdAt"
      ]
    },
    "Payslip": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payslip",
      "type": "object",
      "description": "Detailed record of an employee's earnings, deductions, and net pay for a specific pay period.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payslip entity."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to the Employee this payslip belongs to. (Relationship: Employee 1:N Payslip)"
        },
        "payrollRunId": {
          "type": "string",
          "description": "Reference to the PayrollRun that generated this payslip. (Relationship: PayrollRun 1:N Payslip)"
        },
        "payPeriodStartDate": {
          "type": "string",
          "description": "The start date of the pay period covered by this payslip.",
          "format": "date"
        },
        "payPeriodEndDate": {
          "type": "string",
          "description": "The end date of the pay period covered by this payslip.",
          "format": "date"
        },
        "payDate": {
          "type": "string",
          "description": "The date when the payment for this payslip was or will be disbursed.",
          "format": "date"
        },
        "grossSalary": {
          "type": "number",
          "description": "The total gross salary before any deductions."
        },
        "netSalary": {
          "type": "number",
          "description": "The net salary after all deductions."
        },
        "totalDeductions": {
          "type": "number",
          "description": "The sum of all deductions applied to this payslip."
        },
        "totalAllowances": {
          "type": "number",
          "description": "The sum of all allowances included in this payslip."
        },
        "currencyId": {
          "type": "string",
          "description": "Reference to the Currency of the payslip amounts. (Relationship: Currency 1:N Payslip)"
        },
        "status": {
          "type": "string",
          "description": "The status of the payslip (e.g., 'Generated', 'Paid', 'Void')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the payslip record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the payslip record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "employeeId",
        "payrollRunId",
        "payPeriodStartDate",
        "payPeriodEndDate",
        "payDate",
        "grossSalary",
        "netSalary",
        "totalDeductions",
        "totalAllowances",
        "currencyId",
        "status",
        "createdAt"
      ]
    },
    "PayslipItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PayslipItem",
      "type": "object",
      "description": "Details individual earnings or deductions that make up an employee's payslip.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PayslipItem entity."
        },
        "payslipId": {
          "type": "string",
          "description": "Reference to the parent Payslip. (Relationship: Payslip 1:N PayslipItem)"
        },
        "type": {
          "type": "string",
          "description": "The type of payslip item (e.g., 'Basic Salary', 'Housing Allowance', 'NSSF Deduction', 'KRA PAYE')."
        },
        "amount": {
          "type": "number",
          "description": "The monetary amount for this item."
        },
        "isDeduction": {
          "type": "boolean",
          "description": "Indicates if this item is a deduction (true) or an earning (false)."
        },
        "statutoryDeductionId": {
          "type": "string",
          "description": "Reference to the StatutoryDeduction if this item is a statutory deduction. (Relationship: StatutoryDeduction 1:N PayslipItem)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the payslip item record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the payslip item record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "payslipId",
        "type",
        "amount",
        "isDeduction",
        "createdAt"
      ]
    },
    "LeaveRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaveRequest",
      "type": "object",
      "description": "Manages employee leave requests, including type, dates, and approval status.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LeaveRequest entity."
        },
        "employeeId": {
          "type": "string",
          "description": "Reference to the Employee requesting leave. (Relationship: Employee 1:N LeaveRequest)"
        },
        "requestDate": {
          "type": "string",
          "description": "The date and time when the leave request was submitted.",
          "format": "date-time"
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the requested leave.",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "description": "The end date of the requested leave.",
          "format": "date"
        },
        "leaveType": {
          "type": "string",
          "description": "The type of leave being requested (e.g., 'Annual', 'Sick', 'Maternity', 'Paternity')."
        },
        "status": {
          "type": "string",
          "description": "The current status of the leave request (e.g., 'Pending', 'Approved', 'Rejected', 'Canceled')."
        },
        "approverUserId": {
          "type": "string",
          "description": "Reference to the User who approved or rejected the request. (Relationship: User 1:N LeaveRequest)"
        },
        "comments": {
          "type": "string",
          "description": "Comments related to the leave request or its decision."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the leave request record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the leave request record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "employeeId",
        "requestDate",
        "startDate",
        "endDate",
        "leaveType",
        "status",
        "createdAt"
      ]
    },
    "LoyaltyProgram": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LoyaltyProgram",
      "type": "object",
      "description": "Defines the overall structure and rules of a customer loyalty program.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LoyaltyProgram entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution that owns this loyalty program. (Relationship: Institution 1:N LoyaltyProgram)"
        },
        "name": {
          "type": "string",
          "description": "The name of the loyalty program (e.g., 'iClick Rewards')."
        },
        "pointsEarnRate": {
          "type": "number",
          "description": "The rate at which points are earned (e.g., 1 point per $1 spent)."
        },
        "pointsRedeemRate": {
          "type": "number",
          "description": "The value of points when redeemed (e.g., 100 points = $1 discount)."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the loyalty program is currently active."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the loyalty program record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the loyalty program record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "pointsEarnRate",
        "pointsRedeemRate",
        "isActive",
        "createdAt"
      ]
    },
    "LoyaltyTier": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LoyaltyTier",
      "type": "object",
      "description": "Defines different tiers within a loyalty program, offering varied benefits based on accumulated points.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LoyaltyTier entity."
        },
        "loyaltyProgramId": {
          "type": "string",
          "description": "Reference to the parent LoyaltyProgram. (Relationship: LoyaltyProgram 1:N LoyaltyTier)"
        },
        "name": {
          "type": "string",
          "description": "The name of the loyalty tier (e.g., 'Bronze', 'Silver', 'Gold', 'Platinum')."
        },
        "minPoints": {
          "type": "number",
          "description": "The minimum number of loyalty points required to achieve this tier."
        },
        "benefits": {
          "type": "array",
          "description": "A list of benefits associated with this loyalty tier (e.g., '10% Discount', 'Early Access').",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the loyalty tier record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the loyalty tier record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "loyaltyProgramId",
        "name",
        "minPoints",
        "benefits",
        "createdAt"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Stores customer profiles, purchase history, loyalty points, and credit limits for CRM and loyalty management.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Customer entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this customer belongs to. (Relationship: Institution 1:N Customer)"
        },
        "firstName": {
          "type": "string",
          "description": "The customer's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The customer's last name."
        },
        "email": {
          "type": "string",
          "description": "The customer's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The customer's primary phone number."
        },
        "address": {
          "type": "string",
          "description": "The customer's primary mailing/shipping address."
        },
        "loyaltyPoints": {
          "type": "number",
          "description": "The total loyalty points accumulated by the customer."
        },
        "creditLimit": {
          "type": "number",
          "description": "The maximum credit allowed for the customer."
        },
        "currentCreditBalance": {
          "type": "number",
          "description": "The current outstanding credit balance for the customer."
        },
        "lastPurchaseDate": {
          "type": "string",
          "description": "Timestamp of the customer's last purchase.",
          "format": "date-time"
        },
        "loyaltyTierId": {
          "type": "string",
          "description": "Reference to the LoyaltyTier the customer currently belongs to. (Relationship: LoyaltyTier 1:N Customer)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the customer record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the customer record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "firstName",
        "lastName",
        "email",
        "phone",
        "loyaltyPoints",
        "createdAt"
      ]
    },
    "LoyaltyPointTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LoyaltyPointTransaction",
      "type": "object",
      "description": "Records individual transactions related to loyalty points, such as earning, redeeming, or adjustments.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LoyaltyPointTransaction entity."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to the Customer involved in this transaction. (Relationship: Customer 1:N LoyaltyPointTransaction)"
        },
        "loyaltyProgramId": {
          "type": "string",
          "description": "Reference to the LoyaltyProgram. (Relationship: LoyaltyProgram 1:N LoyaltyPointTransaction)"
        },
        "type": {
          "type": "string",
          "description": "The type of loyalty point transaction (e.g., 'Earned', 'Redeemed', 'Adjusted')."
        },
        "pointsChange": {
          "type": "number",
          "description": "The change in points (positive for earned, negative for redeemed/deducted)."
        },
        "referenceEntityId": {
          "type": "string",
          "description": "The ID of the entity that caused this transaction (e.g., Sale ID, Manual Adjustment ID)."
        },
        "referenceEntityType": {
          "type": "string",
          "description": "The type of entity that caused this transaction (e.g., 'Sale', 'Manual Adjustment')."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date and time of the loyalty point transaction.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the loyalty point transaction record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the loyalty point transaction record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "customerId",
        "loyaltyProgramId",
        "type",
        "pointsChange",
        "transactionDate",
        "createdAt"
      ]
    },
    "PaymentMethod": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PaymentMethod",
      "type": "object",
      "description": "Defines the various payment options available at the Point of Sale.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PaymentMethod entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this payment method belongs to. (Relationship: Institution 1:N PaymentMethod)"
        },
        "name": {
          "type": "string",
          "description": "The name of the payment method (e.g., 'Cash', 'M-Pesa', 'Card', 'Loyalty Points')."
        },
        "type": {
          "type": "string",
          "description": "The general type of payment method (e.g., 'Cash', 'Digital Wallet', 'Card', 'Credit')."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the payment method is currently active and available."
        },
        "isExternal": {
          "type": "boolean",
          "description": "Indicates if the payment method relies on an external gateway (e.g., M-Pesa, card processor)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the payment method record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the payment method record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "type",
        "isActive",
        "isExternal",
        "createdAt"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a single point-of-sale transaction or customer invoice.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Sale entity."
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch where the sale occurred. (Relationship: Branch 1:N Sale)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to the Customer associated with this sale (optional). (Relationship: Customer 1:N Sale)"
        },
        "saleDate": {
          "type": "string",
          "description": "The date and time when the sale was completed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the sale before discounts and taxes."
        },
        "totalTaxAmount": {
          "type": "number",
          "description": "The total tax amount applied to the sale."
        },
        "totalDiscountAmount": {
          "type": "number",
          "description": "The total discount amount applied to the sale."
        },
        "netAmount": {
          "type": "number",
          "description": "The final amount due after all calculations (total amount - discount + tax)."
        },
        "status": {
          "type": "string",
          "description": "The current status of the sale (e.g., 'Completed', 'Pending', 'On Hold', 'Refunded', 'Cancelled')."
        },
        "paymentStatus": {
          "type": "string",
          "description": "The status of payment for the sale (e.g., 'Paid', 'Partial', 'Unpaid', 'Refunded')."
        },
        "currencyId": {
          "type": "string",
          "description": "Reference to the Currency of the sale. (Relationship: Currency 1:N Sale)"
        },
        "salesAssociateUserId": {
          "type": "string",
          "description": "Reference to the User who processed the sale. (Relationship: User 1:N Sale)"
        },
        "journalEntryId": {
          "type": "string",
          "description": "Reference to the JournalEntry created for this sale. (Relationship: JournalEntry 1:N Sale)"
        },
        "invoiceNumber": {
          "type": "string",
          "description": "The unique invoice number for this sale."
        },
        "isCreditSale": {
          "type": "boolean",
          "description": "Indicates if this sale was made on credit."
        },
        "approvalRequestId": {
          "type": "string",
          "description": "Reference to an ApprovalRequest if the sale required approval (e.g., for large discount, credit sale). (Relationship: ApprovalRequest 1:N Sale)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the sale record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the sale record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "branchId",
        "saleDate",
        "totalAmount",
        "totalTaxAmount",
        "totalDiscountAmount",
        "netAmount",
        "status",
        "paymentStatus",
        "currencyId",
        "salesAssociateUserId",
        "invoiceNumber",
        "isCreditSale",
        "createdAt"
      ]
    },
    "SaleItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SaleItem",
      "type": "object",
      "description": "Details individual products or services included as line items in a sale transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SaleItem entity."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the parent Sale transaction. (Relationship: Sale 1:N SaleItem)"
        },
        "productVariantId": {
          "type": "string",
          "description": "Reference to the ProductVariant sold. (Relationship: ProductVariant 1:N SaleItem)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the product variant sold."
        },
        "unitPrice": {
          "type": "number",
          "description": "The unit selling price of the product variant at the time of sale."
        },
        "discountAmount": {
          "type": "number",
          "description": "The discount amount applied to this line item."
        },
        "taxAmount": {
          "type": "number",
          "description": "The tax amount applied to this line item."
        },
        "subtotal": {
          "type": "number",
          "description": "The subtotal for this line item (quantity * unit price - discount + tax)."
        },
        "isReturned": {
          "type": "boolean",
          "description": "Indicates if this item has been returned."
        },
        "returnedQuantity": {
          "type": "number",
          "description": "The quantity of this item that has been returned."
        },
        "batchId": {
          "type": "string",
          "description": "Reference to the Batch from which this item was sold, if applicable. (Relationship: Batch 1:N SaleItem)"
        },
        "serialItemIds": {
          "type": "array",
          "description": "References to SerialItem entities if serial-tracked items were sold. (Relationship: SerialItem N:N SaleItem)",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the sale item record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the sale item record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "saleId",
        "productVariantId",
        "quantity",
        "unitPrice",
        "discountAmount",
        "taxAmount",
        "subtotal",
        "isReturned",
        "returnedQuantity",
        "createdAt"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Records an individual payment made for a sale or other transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the Sale this payment is for. (Relationship: Sale 1:N Payment)"
        },
        "paymentMethodId": {
          "type": "string",
          "description": "Reference to the PaymentMethod used. (Relationship: PaymentMethod 1:N Payment)"
        },
        "amount": {
          "type": "number",
          "description": "The monetary amount of the payment."
        },
        "paymentDate": {
          "type": "string",
          "description": "The date and time when the payment was processed.",
          "format": "date-time"
        },
        "transactionId": {
          "type": "string",
          "description": "External transaction ID from the payment gateway (e.g., M-Pesa transaction ID)."
        },
        "status": {
          "type": "string",
          "description": "The status of the payment (e.g., 'Successful', 'Failed', 'Pending', 'Refunded')."
        },
        "currencyId": {
          "type": "string",
          "description": "Reference to the Currency of the payment. (Relationship: Currency 1:N Payment)"
        },
        "journalEntryId": {
          "type": "string",
          "description": "Reference to the JournalEntry created for this payment. (Relationship: JournalEntry 1:N Payment)"
        },
        "paidByUserId": {
          "type": "string",
          "description": "Reference to the User who recorded this payment, if applicable (e.g., cashier). (Relationship: User 1:N Payment)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the payment record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the payment record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "saleId",
        "paymentMethodId",
        "amount",
        "paymentDate",
        "status",
        "currencyId",
        "createdAt"
      ]
    },
    "MpesaCallback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MpesaCallback",
      "type": "object",
      "description": "Stores raw data received from M-Pesa Instant Payment Notifications (IPN) for automated reconciliation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MpesaCallback entity."
        },
        "transactionId": {
          "type": "string",
          "description": "The M-Pesa Transaction ID (e.g., 'LGHXXXXX')."
        },
        "merchantRequestId": {
          "type": "string",
          "description": "The MerchantRequestID from the STK Push initiation."
        },
        "checkoutRequestId": {
          "type": "string",
          "description": "The CheckoutRequestID from the STK Push initiation."
        },
        "amount": {
          "type": "number",
          "description": "The amount paid in the M-Pesa transaction."
        },
        "mpesaReceiptNumber": {
          "type": "string",
          "description": "The unique M-Pesa receipt number for the transaction."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The customer's M-Pesa phone number."
        },
        "transactionDate": {
          "type": "string",
          "description": "The date and time of the M-Pesa transaction.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the M-Pesa callback (e.g., 'Success', 'Failed', 'Pending')."
        },
        "rawCallbackData": {
          "type": "string",
          "description": "The raw JSON string received from the M-Pesa IPN."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the Sale transaction reconciled with this M-Pesa payment. (Relationship: Sale 1:N MpesaCallback)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the M-Pesa callback record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the M-Pesa callback record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "transactionId",
        "amount",
        "mpesaReceiptNumber",
        "phoneNumber",
        "transactionDate",
        "status",
        "rawCallbackData",
        "createdAt"
      ]
    },
    "Rider": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Rider",
      "type": "object",
      "description": "Manages profiles and real-time status of delivery riders.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Rider entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution the rider works for. (Relationship: Institution 1:N Rider)"
        },
        "firstName": {
          "type": "string",
          "description": "The rider's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The rider's last name."
        },
        "phone": {
          "type": "string",
          "description": "The rider's contact phone number."
        },
        "email": {
          "type": "string",
          "description": "The rider's email address.",
          "format": "email"
        },
        "status": {
          "type": "string",
          "description": "The current status of the rider (e.g., 'Available', 'On Delivery', 'Offline')."
        },
        "currentLocation": {
          "type": "string",
          "description": "The rider's current geographical location (e.g., 'latitude,longitude' string or GeoJSON string)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the rider record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the rider record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "firstName",
        "lastName",
        "phone",
        "status",
        "createdAt"
      ]
    },
    "DeliveryOrder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DeliveryOrder",
      "type": "object",
      "description": "Manages delivery requests associated with sales, including dispatch tracking and rider assignment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DeliveryOrder entity."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the Sale transaction for this delivery. (Relationship: Sale 1:N DeliveryOrder)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to the Customer receiving the delivery. (Relationship: Customer 1:N DeliveryOrder)"
        },
        "deliveryAddress": {
          "type": "string",
          "description": "The full address for the delivery."
        },
        "deliveryFee": {
          "type": "number",
          "description": "The fee charged for this delivery."
        },
        "riderId": {
          "type": "string",
          "description": "Reference to the Rider assigned to this delivery. (Relationship: Rider 1:N DeliveryOrder)"
        },
        "status": {
          "type": "string",
          "description": "The current status of the delivery (e.g., 'Pending', 'Dispatched', 'En Route', 'Delivered', 'Cancelled')."
        },
        "pickupTime": {
          "type": "string",
          "description": "The scheduled or actual time of pickup from the branch.",
          "format": "date-time"
        },
        "deliveryTime": {
          "type": "string",
          "description": "The scheduled or actual time of delivery to the customer.",
          "format": "date-time"
        },
        "trackingNumber": {
          "type": "string",
          "description": "A unique tracking number for the delivery."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the delivery order record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the delivery order record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "saleId",
        "customerId",
        "deliveryAddress",
        "deliveryFee",
        "status",
        "createdAt"
      ]
    },
    "Doctor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Doctor",
      "type": "object",
      "description": "Manages information about doctors, primarily for linking with prescription management in pharmacies.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Doctor entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this doctor is associated with (e.g., a partner clinic). (Relationship: Institution 1:N Doctor)"
        },
        "firstName": {
          "type": "string",
          "description": "The doctor's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The doctor's last name."
        },
        "contactPhone": {
          "type": "string",
          "description": "The doctor's contact phone number."
        },
        "contactEmail": {
          "type": "string",
          "description": "The doctor's contact email address.",
          "format": "email"
        },
        "medicalLicenseNumber": {
          "type": "string",
          "description": "The doctor's medical license number."
        },
        "clinicName": {
          "type": "string",
          "description": "The name of the clinic or hospital the doctor works at."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the doctor record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the doctor record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "firstName",
        "lastName",
        "medicalLicenseNumber",
        "createdAt"
      ]
    },
    "Prescription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prescription",
      "type": "object",
      "description": "Records details of medical prescriptions, used in the pharmacy module for dispensing and tracking.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Prescription entity."
        },
        "saleId": {
          "type": "string",
          "description": "Reference to the Sale transaction where this prescription was fulfilled. (Relationship: Sale 1:N Prescription)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to the Customer for whom the prescription was written. (Relationship: Customer 1:N Prescription)"
        },
        "doctorId": {
          "type": "string",
          "description": "Reference to the Doctor who issued the prescription. (Relationship: Doctor 1:N Prescription)"
        },
        "prescriptionDate": {
          "type": "string",
          "description": "The date when the prescription was issued.",
          "format": "date"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL to an uploaded image of the physical prescription document.",
          "format": "uri"
        },
        "medicationDetails": {
          "type": "string",
          "description": "A detailed description of the prescribed medications and dosages."
        },
        "status": {
          "type": "string",
          "description": "The status of the prescription (e.g., 'New', 'Filled', 'Partially Filled', 'Rejected')."
        },
        "filledByUserId": {
          "type": "string",
          "description": "Reference to the User (pharmacist) who filled the prescription. (Relationship: User 1:N Prescription)"
        },
        "dosageInstructions": {
          "type": "string",
          "description": "Instructions for dosage and administration to be printed on labels."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the prescription record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the prescription record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "customerId",
        "doctorId",
        "prescriptionDate",
        "medicationDetails",
        "status",
        "createdAt"
      ]
    },
    "DrugCategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DrugCategory",
      "type": "object",
      "description": "Categorizes drugs by generic name, brand, and schedule for pharmacy management.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the DrugCategory entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this drug category belongs to. (Relationship: Institution 1:N DrugCategory)"
        },
        "name": {
          "type": "string",
          "description": "The name of the drug category (e.g., 'Antibiotics', 'Painkillers', 'Controlled Substance')."
        },
        "description": {
          "type": "string",
          "description": "A description of the drug category."
        },
        "schedule": {
          "type": "string",
          "description": "The controlled substance schedule for the drug category (e.g., 'Schedule II', 'OTC')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the drug category record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the drug category record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "name",
        "createdAt"
      ]
    },
    "FloorLayout": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FloorLayout",
      "type": "object",
      "description": "Manages visual floor plans for restaurants and bars, mapping tables and sections.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the FloorLayout entity."
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch this floor layout belongs to. (Relationship: Branch 1:N FloorLayout)"
        },
        "name": {
          "type": "string",
          "description": "The name of the floor layout (e.g., 'Main Dining Area', 'Outdoor Patio')."
        },
        "description": {
          "type": "string",
          "description": "A description of the floor layout."
        },
        "layoutJson": {
          "type": "string",
          "description": "A JSON string representing the visual layout data (e.g., positions of tables)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the floor layout record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the floor layout record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "branchId",
        "name",
        "createdAt"
      ]
    },
    "Table": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Table",
      "type": "object",
      "description": "Represents individual tables or seating areas in a restaurant or bar, with status tracking.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Table entity."
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch this table is located in. (Relationship: Branch 1:N Table)"
        },
        "floorLayoutId": {
          "type": "string",
          "description": "Reference to the FloorLayout this table is part of. (Relationship: FloorLayout 1:N Table)"
        },
        "name": {
          "type": "string",
          "description": "The name or number of the table (e.g., 'Table 1', 'Bar Seat 3')."
        },
        "capacity": {
          "type": "number",
          "description": "The seating capacity of the table."
        },
        "status": {
          "type": "string",
          "description": "The current status of the table (e.g., 'Open', 'Occupied', 'Dirty', 'Reserved')."
        },
        "currentSaleId": {
          "type": "string",
          "description": "Reference to the active Sale ID if the table is currently occupied. (Relationship: Sale 1:N Table)"
        },
        "positionX": {
          "type": "number",
          "description": "X-coordinate for the table's position on the floor layout UI."
        },
        "positionY": {
          "type": "number",
          "description": "Y-coordinate for the table's position on the floor layout UI."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the table record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the table record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "branchId",
        "floorLayoutId",
        "name",
        "capacity",
        "status",
        "createdAt"
      ]
    },
    "Recipe": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recipe",
      "type": "object",
      "description": "Defines ingredients and instructions for preparing finished food or beverage products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Recipe entity."
        },
        "institutionId": {
          "type": "string",
          "description": "Reference to the Institution this recipe belongs to. (Relationship: Institution 1:N Recipe)"
        },
        "productVariantId": {
          "type": "string",
          "description": "Reference to the finished ProductVariant produced by this recipe. (Relationship: ProductVariant 1:N Recipe)"
        },
        "name": {
          "type": "string",
          "description": "The name of the recipe (e.g., 'Cheeseburger Patty', 'Espresso Shot')."
        },
        "description": {
          "type": "string",
          "description": "A description of the recipe."
        },
        "preparationInstructions": {
          "type": "string",
          "description": "Detailed step-by-step instructions for preparing the item."
        },
        "yieldQuantity": {
          "type": "number",
          "description": "The quantity of the finished product produced by this recipe."
        },
        "unitOfMeasure": {
          "type": "string",
          "description": "The unit of measure for the yield quantity (e.g., 'serving', 'liter')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the recipe record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the recipe record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "institutionId",
        "productVariantId",
        "name",
        "preparationInstructions",
        "yieldQuantity",
        "unitOfMeasure",
        "createdAt"
      ]
    },
    "RecipeIngredient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RecipeIngredient",
      "type": "object",
      "description": "Details the raw ingredients and their quantities required for a specific recipe.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RecipeIngredient entity."
        },
        "recipeId": {
          "type": "string",
          "description": "Reference to the parent Recipe. (Relationship: Recipe 1:N RecipeIngredient)"
        },
        "ingredientProductVariantId": {
          "type": "string",
          "description": "Reference to the ProductVariant that serves as an ingredient. (Relationship: ProductVariant 1:N RecipeIngredient)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of this ingredient required for the recipe."
        },
        "unitOfMeasure": {
          "type": "string",
          "description": "The unit of measure for the ingredient quantity (e.g., 'gram', 'ml', 'pcs')."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the recipe ingredient record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the recipe ingredient record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "recipeId",
        "ingredientProductVariantId",
        "quantity",
        "unitOfMeasure",
        "createdAt"
      ]
    },
    "KitchenDisplayOrder": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "KitchenDisplayOrder",
      "type": "object",
      "description": "Represents an order item sent to a kitchen or bar display system (KDS), tracking its preparation status.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the KitchenDisplayOrder entity."
        },
        "saleItemId": {
          "type": "string",
          "description": "Reference to the SaleItem that generated this KDS order. (Relationship: SaleItem 1:N KitchenDisplayOrder)"
        },
        "branchId": {
          "type": "string",
          "description": "Reference to the Branch where the order is being prepared. (Relationship: Branch 1:N KitchenDisplayOrder)"
        },
        "orderTime": {
          "type": "string",
          "description": "The date and time when the order was sent to the KDS.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The current status of the order item in the kitchen (e.g., 'New', 'In Progress', 'Ready', 'Served', 'Cancelled')."
        },
        "notes": {
          "type": "string",
          "description": "Special preparation notes or customer requests for this item."
        },
        "station": {
          "type": "string",
          "description": "The preparation station for this item (e.g., 'Kitchen', 'Bar', 'Dessert')."
        },
        "servedTime": {
          "type": "string",
          "description": "Timestamp when the item was marked as served.",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the KDS order record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp when the KDS order record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "saleItemId",
        "branchId",
        "orderTime",
        "status",
        "station",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/system_admins/{uid}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Dedicated collection for system-wide administrators. The existence of a document at this path for a user's UID grants them super-admin privileges. Used for DBAC and Authorization Independence."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles and core metadata. This is the primary user document, distinct from authorization-specific collections."
        }
      },
      {
        "path": "/user_institutions/{userId}/memberships/{institutionId}",
        "definition": {
          "entityName": "Institution",
          "schema": {
            "$ref": "#/backend/entities/Institution"
          },
          "description": "An existence-based collection to quickly verify if a user belongs to a specific institution, enabling Authorization Independence for rules without fetching the full user profile. An empty document at this path indicates membership."
        }
      },
      {
        "path": "/currencies/{currencyId}",
        "definition": {
          "entityName": "Currency",
          "schema": {
            "$ref": "#/backend/entities/Currency"
          },
          "description": "Global collection for defining supported currencies. Accessible read-only by all authenticated users; managed by system admins."
        }
      },
      {
        "path": "/permissions/{permissionId}",
        "definition": {
          "entityName": "Permission",
          "schema": {
            "$ref": "#/backend/entities/Permission"
          },
          "description": "Global collection for defining system permissions. Accessible read-only by all authenticated users; managed by system admins."
        }
      },
      {
        "path": "/institutions/{institutionId}",
        "definition": {
          "entityName": "Institution",
          "schema": {
            "$ref": "#/backend/entities/Institution"
          },
          "description": "Top-level collection for each business organization. Access controlled by institution members/admins."
        }
      },
      {
        "path": "/institutions/{institutionId}/document_sequences/{sequenceId}",
        "definition": {
          "entityName": "DocumentSequence",
          "schema": {
            "$ref": "#/backend/entities/DocumentSequence"
          },
          "description": "Institutional settings for document numbering sequences."
        }
      },
      {
        "path": "/institutions/{institutionId}/roles/{roleId}/members/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "An existence-based collection to quickly verify if a user has a specific role within an institution, enabling Authorization Independence for rules without fetching complex role data."
        }
      },
      {
        "path": "/institutions/{institutionId}/roles/{roleId}",
        "definition": {
          "entityName": "Role",
          "schema": {
            "$ref": "#/backend/entities/Role"
          },
          "description": "Defines specific roles for users within an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/tax_settings/{taxSettingId}",
        "definition": {
          "entityName": "TaxSetting",
          "schema": {
            "$ref": "#/backend/entities/TaxSetting"
          },
          "description": "Configures tax rates and rules for an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/approval_workflows/{workflowId}",
        "definition": {
          "entityName": "ApprovalWorkflow",
          "schema": {
            "$ref": "#/backend/entities/ApprovalWorkflow"
          },
          "description": "Defines approval processes specific to an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/approval_requests/{requestId}",
        "definition": {
          "entityName": "ApprovalRequest",
          "schema": {
            "$ref": "#/backend/entities/ApprovalRequest"
          },
          "description": "Records requests requiring approval within an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/product_categories/{categoryId}",
        "definition": {
          "entityName": "ProductCategory",
          "schema": {
            "$ref": "#/backend/entities/ProductCategory"
          },
          "description": "Hierarchical categorization of products within an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/vendors/{vendorId}",
        "definition": {
          "entityName": "Vendor",
          "schema": {
            "$ref": "#/backend/entities/Vendor"
          },
          "description": "Manages vendor information for an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Core product definitions for an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/stock_transfers/{transferId}",
        "definition": {
          "entityName": "StockTransfer",
          "schema": {
            "$ref": "#/backend/entities/StockTransfer"
          },
          "description": "Records stock movements between branches within an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/stock_transfers/{transferId}/items/{transferItemId}",
        "definition": {
          "entityName": "StockTransferItem",
          "schema": {
            "$ref": "#/backend/entities/StockTransferItem"
          },
          "description": "Details individual items in a stock transfer. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/chart_of_accounts/{accountId}",
        "definition": {
          "entityName": "ChartOfAccount",
          "schema": {
            "$ref": "#/backend/entities/ChartOfAccount"
          },
          "description": "Defines financial accounts for an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/budgets/{budgetId}",
        "definition": {
          "entityName": "Budget",
          "schema": {
            "$ref": "#/backend/entities/Budget"
          },
          "description": "Manages institution-wide budgets. Includes denormalized 'institutionId' for authorization independence. Branch and Department IDs would be null or absent."
        }
      },
      {
        "path": "/institutions/{institutionId}/statutory_deductions/{deductionId}",
        "definition": {
          "entityName": "StatutoryDeduction",
          "schema": {
            "$ref": "#/backend/entities/StatutoryDeduction"
          },
          "description": "Configures mandatory statutory deductions for an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/loyalty_programs/{programId}",
        "definition": {
          "entityName": "LoyaltyProgram",
          "schema": {
            "$ref": "#/backend/entities/LoyaltyProgram"
          },
          "description": "Defines loyalty programs for an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/loyalty_programs/{programId}/tiers/{tierId}",
        "definition": {
          "entityName": "LoyaltyTier",
          "schema": {
            "$ref": "#/backend/entities/LoyaltyTier"
          },
          "description": "Defines tiers within a loyalty program. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profiles for an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/customers/{customerId}/loyalty_point_transactions/{transactionId}",
        "definition": {
          "entityName": "LoyaltyPointTransaction",
          "schema": {
            "$ref": "#/backend/entities/LoyaltyPointTransaction"
          },
          "description": "Records loyalty point transactions for a customer. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/payment_methods/{methodId}",
        "definition": {
          "entityName": "PaymentMethod",
          "schema": {
            "$ref": "#/backend/entities/PaymentMethod"
          },
          "description": "Defines payment options for an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/mpesa_callbacks/{callbackId}",
        "definition": {
          "entityName": "MpesaCallback",
          "schema": {
            "$ref": "#/backend/entities/MpesaCallback"
          },
          "description": "Stores raw M-Pesa callback data. Includes denormalized 'institutionId' (and potentially 'branchId' from the associated sale) for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/riders/{riderId}",
        "definition": {
          "entityName": "Rider",
          "schema": {
            "$ref": "#/backend/entities/Rider"
          },
          "description": "Manages delivery rider profiles for an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/doctors/{doctorId}",
        "definition": {
          "entityName": "Doctor",
          "schema": {
            "$ref": "#/backend/entities/Doctor"
          },
          "description": "Manages doctor information relevant to an institution (e.g., for pharmacies). Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/drug_categories/{categoryId}",
        "definition": {
          "entityName": "DrugCategory",
          "schema": {
            "$ref": "#/backend/entities/DrugCategory"
          },
          "description": "Categorizes drugs for pharmacy operations within an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/recipes/{recipeId}",
        "definition": {
          "entityName": "Recipe",
          "schema": {
            "$ref": "#/backend/entities/Recipe"
          },
          "description": "Defines recipes for food/beverage products. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/recipes/{recipeId}/ingredients/{ingredientId}",
        "definition": {
          "entityName": "RecipeIngredient",
          "schema": {
            "$ref": "#/backend/entities/RecipeIngredient"
          },
          "description": "Details ingredients for a specific recipe. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}",
        "definition": {
          "entityName": "Branch",
          "schema": {
            "$ref": "#/backend/entities/Branch"
          },
          "description": "Represents a physical branch location of an institution. Includes denormalized 'institutionId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/departments/{departmentId}",
        "definition": {
          "entityName": "Department",
          "schema": {
            "$ref": "#/backend/entities/Department"
          },
          "description": "Defines departments within a branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/product_variants/{variantId}",
        "definition": {
          "entityName": "ProductVariant",
          "schema": {
            "$ref": "#/backend/entities/ProductVariant"
          },
          "description": "Specific variants of products, managed at the branch level. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/batches/{batchId}",
        "definition": {
          "entityName": "Batch",
          "schema": {
            "$ref": "#/backend/entities/Batch"
          },
          "description": "Tracks product batches within a branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/serial_items/{serialItemId}",
        "definition": {
          "entityName": "SerialItem",
          "schema": {
            "$ref": "#/backend/entities/SerialItem"
          },
          "description": "Tracks individual serial-numbered items within a branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/purchase_orders/{purchaseOrderId}",
        "definition": {
          "entityName": "PurchaseOrder",
          "schema": {
            "$ref": "#/backend/entities/PurchaseOrder"
          },
          "description": "Manages purchase orders initiated by a specific branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/purchase_orders/{purchaseOrderId}/items/{purchaseOrderItemId}",
        "definition": {
          "entityName": "PurchaseOrderItem",
          "schema": {
            "$ref": "#/backend/entities/PurchaseOrderItem"
          },
          "description": "Details individual items within a purchase order. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/goods_received_notes/{grnId}",
        "definition": {
          "entityName": "GoodsReceivedNote",
          "schema": {
            "$ref": "#/backend/entities/GoodsReceivedNote"
          },
          "description": "Documents received goods at a branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/goods_received_notes/{grnId}/items/{grnItemId}",
        "definition": {
          "entityName": "GoodsReceivedNoteItem",
          "schema": {
            "$ref": "#/backend/entities/GoodsReceivedNoteItem"
          },
          "description": "Details individual items in a Goods Received Note. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/stock_adjustments/{adjustmentId}",
        "definition": {
          "entityName": "StockAdjustment",
          "schema": {
            "$ref": "#/backend/entities/StockAdjustment"
          },
          "description": "Records inventory adjustments within a branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/journal_entries/{entryId}",
        "definition": {
          "entityName": "JournalEntry",
          "schema": {
            "$ref": "#/backend/entities/JournalEntry"
          },
          "description": "Groups financial transactions within a branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/journal_entries/{entryId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Individual debit/credit entries within a journal entry. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/budgets/{budgetId}",
        "definition": {
          "entityName": "Budget",
          "schema": {
            "$ref": "#/backend/entities/Budget"
          },
          "description": "Manages budgets specific to a branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/departments/{departmentId}/budgets/{budgetId}",
        "definition": {
          "entityName": "Budget",
          "schema": {
            "$ref": "#/backend/entities/Budget"
          },
          "description": "Manages budgets specific to a department within a branch. Includes denormalized 'institutionId', 'branchId', and 'departmentId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/employees/{employeeId}",
        "definition": {
          "entityName": "Employee",
          "schema": {
            "$ref": "#/backend/entities/Employee"
          },
          "description": "Stores employee profiles assigned to a specific branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/employees/{employeeId}/leave_requests/{requestId}",
        "definition": {
          "entityName": "LeaveRequest",
          "schema": {
            "$ref": "#/backend/entities/LeaveRequest"
          },
          "description": "Manages leave requests for employees within a branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/payroll_runs/{runId}",
        "definition": {
          "entityName": "PayrollRun",
          "schema": {
            "$ref": "#/backend/entities/PayrollRun"
          },
          "description": "Records payroll runs for a specific branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/payroll_runs/{runId}/payslips/{payslipId}",
        "definition": {
          "entityName": "Payslip",
          "schema": {
            "$ref": "#/backend/entities/Payslip"
          },
          "description": "Detailed record of an employee's payslip for a payroll run. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/payroll_runs/{runId}/payslips/{payslipId}/items/{payslipItemId}",
        "definition": {
          "entityName": "PayslipItem",
          "schema": {
            "$ref": "#/backend/entities/PayslipItem"
          },
          "description": "Details individual earnings or deductions in a payslip. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Represents a point-of-sale transaction at a branch. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/sales/{saleId}/items/{saleItemId}",
        "definition": {
          "entityName": "SaleItem",
          "schema": {
            "$ref": "#/backend/entities/SaleItem"
          },
          "description": "Details individual products or services in a sale transaction. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/sales/{saleId}/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Records individual payments for a sale. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/delivery_orders/{orderId}",
        "definition": {
          "entityName": "DeliveryOrder",
          "schema": {
            "$ref": "#/backend/entities/DeliveryOrder"
          },
          "description": "Manages delivery requests originating from a branch's sale. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/prescriptions/{prescriptionId}",
        "definition": {
          "entityName": "Prescription",
          "schema": {
            "$ref": "#/backend/entities/Prescription"
          },
          "description": "Records medical prescriptions processed at a branch (pharmacy). Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/floor_layouts/{layoutId}",
        "definition": {
          "entityName": "FloorLayout",
          "schema": {
            "$ref": "#/backend/entities/FloorLayout"
          },
          "description": "Manages visual floor plans for a branch (e.g., restaurant). Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/floor_layouts/{layoutId}/tables/{tableId}",
        "definition": {
          "entityName": "Table",
          "schema": {
            "$ref": "#/backend/entities/Table"
          },
          "description": "Represents individual tables within a floor layout. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      },
      {
        "path": "/institutions/{institutionId}/branches/{branchId}/kitchen_display_orders/{orderId}",
        "definition": {
          "entityName": "KitchenDisplayOrder",
          "schema": {
            "$ref": "#/backend/entities/KitchenDisplayOrder"
          },
          "description": "Represents an order item sent to a kitchen/bar display system. Includes denormalized 'institutionId' and 'branchId' for authorization independence."
        }
      }
    ],
    "reasoning": "The Firestore structure for iClick ERP is designed around a multi-tenant, multi-branch architecture, adhering strictly to the core design principles to ensure security, scalability, and debuggability. The primary organizational unit is the 'Institution', followed by 'Branch' for location-specific operations. Most transactional and master data are nested under these hierarchies, ensuring clear ownership and scope.\n\n**Authorization Independence (CRITICAL) via Denormalization:**\nThis design heavily relies on denormalization to achieve authorization independence and avoid `get()` calls for hierarchical data dependencies. Every document that requires access control based on its institution or branch context will have `institutionId` and `branchId` (where applicable) explicitly stored within its own fields. For example, a `SaleItem` will not need to `get()` its parent `Sale` document to determine its `branchId` or `institutionId` because these IDs are duplicated into the `SaleItem` document itself. This is reflected in the descriptions of relevant `firestorePaths` entries. This strategy is vital for atomic operations like transactions and batches, as rules can evaluate permissions without reading other documents.\n\nFor user-specific authorization (DBAC, no custom claims), an 'existence over content' strategy is employed to minimize `get()` calls in rules. Instead of fetching the full `/users/{userId}` document for every authorization check, specific collections are introduced:\n*   `/system_admins/{uid}`: An empty document at this path signifies a global super-admin. Rules can check `exists(/system_admins/$(request.auth.uid))`. \n*   `/user_institutions/{uid}/memberships/{institutionId}`: An empty document signifies that `uid` is a member of `institutionId`. Rules can check `exists(/user_institutions/$(request.auth.uid)/memberships/$(institutionId))`.\n*   `/institutions/{institutionId}/roles/{roleId}/members/{uid}`: An empty document signifies that `uid` has a specific `roleId` within `institutionId`. This allows granular role-based checks like `exists(/institutions/$(resource.data.institutionId)/roles/$(adminRoleId)/members/$(request.auth.uid))`.\nThis approach ensures that authorization rules are robust, performant, and do not introduce complex data dependencies.\n\n**QAPs (Queries as Authorization Policies):**\nThe structural segregation, where most data is nested under `/institutions/{institutionId}/` and `/institutions/{institutionId}/branches/{branchId}/`, directly facilitates QAPs. When a client performs a `list` operation on a collection like `/institutions/{institutionId}/branches/{branchId}/sales`, the query inherently filters by the specified institution and branch. Security rules can then simply verify that `request.auth.uid` is authorized to access data within that specific `institutionId` and `branchId` by checking the denormalized `resource.data.institutionId` and `resource.data.branchId` against the user's established membership/roles, or by checking the existence of documents in the dedicated user context collections (e.g., `/user_institutions/{uid}/memberships/{institutionId}`). This eliminates the need for rules to act as data filters, as the client's query already aligns with their access scope."
  }
}
